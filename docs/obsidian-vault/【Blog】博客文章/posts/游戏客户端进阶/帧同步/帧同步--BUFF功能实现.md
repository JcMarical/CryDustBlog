---
date: 2025-06-16T13:32:37
publish: false
comments: true
permalink: LockStepBuff
aliases:
---

# 帧同步BUFF功能实现
buff其实也是技能的一部分，和技能的区别主要在于其不是由玩家操作直接触发，而是**通过技能、道具或者条件**进行的一种附着施加，可以有**持续**附着触发逻辑的效果。并且通用技能一般只会处理基础伤害行为，而buff可以使得属性的处理更加多样。

## BUFF逻辑层主要功能：
- **单位附着**：施法者、目标、范围（比如在场景中持续存在）、子弹等。
- **延时作用**：等待一段时间后再开始生效。
- **目标判定**：检测敌方、友方、全体、范围等等，施加效果
- **间隔计时**：在计时期间持续触发（持续性回血、DOT伤害等）。

## BUFF 逻辑单元
BUFF的逻辑单元比技能简洁一些。只需按照：**【构造->初始化->更新->反初始化】** 这一套执行即可。

- **一些buff信息的缓存数据**
- **构造函数**：用于获取buff的信息（起源目标，作用目标，起源技能，BUFFID、特别参数等）
- **LogicInit**初始化函数：通过BUFFID拿配置，对BUFF进行初始化。
- **LogicTick**逻辑更新：进行BUFF状态转换和具体BUFF逻辑实现。
- **LogicUnInit**反初始化

## BUFF状态转换
BUFF可以抽象为下面五种状态，理解下面**五种状态**就可以理解BUFF的功能，然后放在**LogicTick**处理功能就好。

**五大状态**：
- **None**：BUFF完全失效，无需逻辑处理，此时可用轮询去除。
**逻辑更新处理LogicTick（）：**
- **Delay**：延时触发
- **Start**：
	- 处理**单次触发的逻辑**
	- 判断**BUFF时效（单次、限时、永久）**，转换到不同的分支
- **Tick**：
	- 制作**间隔触发逻辑**
	- **保持计时**，判断是限时还是永久最后进入不同分支
- END：BUFF结束逻辑，进行**资源清理**和**属性回调**，清理结束转为None。


# BUFF 管理
已经开始运行的BUFF类存储在主逻辑单元的技能模块**MainLogicSkill**中，用一个List来作为容器。
- **BUFF插入**：创建buff时，需直接加入List
- **逻辑执行**：逻辑帧每帧轮询状态，执行LogicTick逻辑。
- **删除BUFF**：轮询检测到None，触发LogicUnInit，并从容器中将BUFF移除。